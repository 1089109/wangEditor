<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>we-2021 demo</title>
<link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
<style>
  /* 编辑器 dom */
  #container {
    width: 800px;
  }

  #editor-toolbar {
    border: 1px solid #ccc;
    /* z-index: 100; */
  }

  #editor-text-area {
    border: 1px solid #ccc;
    height: 350px;
    /* overflow: hidden; */
    /* z-index: 100; */
  }

  /* 显示内容 */
  #editor-content-view {
    border-top: 1px solid #ccc;
    margin-top: 30px;
  }

  #editor-content-view td,
  #editor-content-view th {
    border: 1px solid #ccc;
    min-width: 50px;
    height: 20px;
  }

  #editor-content-view th {
    background-color: #f1f1f1;
  }

  #editor-content-view blockquote {
    border-left: 8px solid #d0e5f2;
    padding: 10px 10px;
    margin: 10px 0;
    background-color: #f1f1f1;
  }
</style>
<link href="./css/style.css" rel="stylesheet"> <!-- 即 dist/css/style.css -->
</head>

<body>
  <p>
    index page
    <button id="btn-create">create</button>
    <button id="btn-toggle-readOnly">toggle readOnly</button>
    <button id="btn-destroy">destroy</button>
  </p>

  <!-- 编辑器 -->
  <div id="container">
    <div id="editor-toolbar"></div>
    <div style="height: 10px;">
      <!-- 间隔 -->
    </div>
    <div id="editor-text-area"></div>
  </div>

  <!-- 内容状态 -->
  <p style="background-color: #f1f1f1;">
    当前文字数量：<span id="total-length"></span>；
    选中文字数量：<span id="selected-length"></span>；
    选中文字："<span id="selected-text"></span>"
  </p>

  <!-- 显示内容 -->
  <div id="editor-content-view"></div>

  <script src="js/init-content.js"></script>
  <script src="./index.js"></script> <!-- 即 dist/index.js -->
  <script>
    wangEditor = window.wangEditor.default

    const editorConfig = { MENU_CONF: {} }
    // editorConfig.autoFocus = false
    // editorConfig.readOnly = true
    // editorConfig.scroll = false
    // editorConfig.maxLength = 120 // 慎用，可能影响性能，需在文档中说明
    // editorConfig.onMaxLength = (editorCore) => {
    //   console.log('on max length', editorCore)
    // }
    editorConfig.placeholder = '请输入内容'
    editorConfig.MENU_CONF['uploadImage'] = {
      server: 'http://106.12.198.214:3000/api/upload-img', // 上传图片地址
      fieldName: 'index-fileName'
    }
    console.log('测试上传图片，请使用 upload-image.html')
    editorConfig.onCreated = (editorCore) => {
      console.log('on created', editorCore)
    }
    editorConfig.onChange = (editorCore) => {
      // 获取 html （使用异步，类似 Vue $nextTick）
      Promise.resolve().then(() => {
        const html = editorCore.getHtml()
        document.getElementById('editor-content-view').innerHTML = html
      })

      // 选中文字
      const selectionText = editorCore.getSelectionText()
      document.getElementById('selected-text').innerHTML = selectionText
      document.getElementById('selected-length').innerHTML = selectionText.length
      // 全部文字
      document.getElementById('total-length').innerHTML = editorCore.getText().length
    }
    editorConfig.onDestroyed = (editorCore) => {
      console.log('on destroyed', editorCore)
    }
    // editorConfig.onFocus = (editorCore) => {
    //   console.log('onFocus', editorCore)
    // }
    // editorConfig.onBlur = (editorCore) => {
    //   console.log('onBlur', editorCore)
    // }
    // editorConfig.MENU_CONF['insertImage'] = {
    //   onInsertedImage(src, alt, url) {
    //     console.log('inserted image', src, alt, url)
    //   },
    //   checkImage(src, alt, url) {
    //     return '强制阻止 1'
    //     // return true
    //   }
    // }
    // editorConfig.MENU_CONF['insertImage'] = {
    //   onUpdatedImage(src, alt, url) {
    //     console.log('updated image', src, alt, url)
    //   },
    //   checkImage(src, alt, url) {
    //     return '强制阻止 2'
    //     // return true
    //   }
    // }
    // editorConfig.MENU_CONF['insertLink'] = {
    //   checkLink(text, url) {
    //     console.log('check insert link - ', text, url)
    //     // return true
    //     return '强制阻止 1'
    //   }
    // }
    // editorConfig.MENU_CONF['updateLink'] = {
    //   checkLink(text, url) {
    //     console.log('check update link - ', text, url)
    //     // return true
    //     return '强制阻止 2'
    //   }
    // }
    // editorConfig.MENU_CONF['insertVideo'] = {
    //   onInsertedVideo(src) {
    //     console.log('inserted video', src)
    //   },
    //   checkVideo(src) {
    //     return '强制阻止 1'
    //     // return true
    //   }
    // }

    // create
    let editor, toolbar
    document.getElementById('btn-create').addEventListener('click', () => {
      editor = wangEditor.createEditor({
        textareaSelector: '#editor-text-area',
        // textareaSelector: document.getElementById('editor-text-area'),
        initContent: window.initContent,
        config: editorConfig
      })

      toolbar = wangEditor.createToolbar({
        editor,
        toolbarSelector: '#editor-toolbar',
        // toolbarSelector: document.getElementById('editor-toolbar')
        // config: {}
      })
    })
    console.log(`如果页面没有编辑器，点击 'create' 按钮创建`)

    // toggle readOnly
    document.getElementById('btn-toggle-readOnly').addEventListener('click', () => {
      editorConfig.readOnly = !editorConfig.readOnly
      editor.setConfig({ readOnly: editorConfig.readOnly })
    })

    // destroy
    document.getElementById('btn-destroy').addEventListener('click', () => {
      editor.destroy()
      editor = undefined
    })
  </script>
</body>

</html>